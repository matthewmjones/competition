<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Competition Dashboard</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <nav class="navbar" role="navigation" aria-label="Main navigation">
        <div class="navbar-container">
            <a href="/" class="navbar-brand">Competition App</a>

            <button class="navbar-toggle" 
                    aria-label="Toggle navigation menu" 
                    aria-expanded="false"
                    aria-controls="navbar-menu">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </button>
        </div>

        <div class="navbar-menu" id="navbar-menu">
            <ul class="navbar-nav">
                <li><a href="/">Home</a></li>
                <li><a href="/dashboard">All Companies</a></li>
                <li><a href="/dashboard/company">Select Company</a></li>
                <li><a href="/company_input">Add Company</a></li>
                <li><a href="/price_input">Add Price</a></li>
                <li><a href="/admin" class="active">Admin</a></li>
            </ul>
        </div>
    </nav>

    <div class="content-wrapper">
        <div class="admin-panel">
        <h1>Admin Panel</h1>
        
        <div class="alert" id="alert"></div>
        
        <div class="stats-card">
            <h3>Current Database Statistics</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" th:text="${stats.companies}">0</div>
                    <div class="stat-label">Companies</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" th:text="${stats.prices}">0</div>
                    <div class="stat-label">Price Records</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" th:text="${stats.demands}">0</div>
                    <div class="stat-label">Demand Records</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" th:text="${stats.profits}">0</div>
                    <div class="stat-label">Profit Records</div>
                </div>
            </div>
        </div>
        
        <div class="action-card danger">
            <h3>Data Reset Options</h3>
            <p><strong>Warning:</strong> These actions cannot be undone. Make sure you understand what each option does:</p>
            
            <div style="margin: 20px 0;">
                <button class="reset-button" onclick="showResetDataConfirmation()">
                    Reset Data Only
                </button>
                <p style="margin: 5px 0; color: #666;">
                    Deletes all price, demand, and profit data. <strong>Companies are preserved.</strong>
                </p>
            </div>
            
            <div style="margin: 20px 0;">
                <button class="reset-button" onclick="showResetAllConfirmation()">
                    Reset Everything
                </button>
                <p style="margin: 5px 0; color: #666;">
                    Deletes <strong>all data</strong> including companies, prices, demands, and profits.
                </p>
            </div>
        </div>
        
        <!-- Confirmation dialog for data-only reset -->
        <div class="confirmation-box" id="resetDataConfirmation">
            <h4>⚠️ Confirm Data Reset</h4>
            <p>This will delete <strong th:text="${stats.prices + stats.demands + stats.profits}">X</strong> records (prices, demands, profits) while keeping <strong th:text="${stats.companies}">X</strong> companies.</p>
            <p>Type <code>DELETE_DATA_KEEP_COMPANIES</code> to confirm:</p>
            <input type="text" class="confirmation-input" id="dataConfirmText" placeholder="Type confirmation text here">
            <div style="margin-top: 15px;">
                <button class="confirm-button" onclick="executeResetData()">Delete Data</button>
                <button class="cancel-button" onclick="hideConfirmations()">Cancel</button>
            </div>
        </div>
        
        <!-- Confirmation dialog for complete reset -->
        <div class="confirmation-box" id="resetAllConfirmation">
            <h4>⚠️ Confirm Complete Reset</h4>
            <p>This will delete <strong>ALL DATA</strong> including <strong th:text="${stats.companies + stats.prices + stats.demands + stats.profits}">X</strong> total records.</p>
            <p>Type <code>DELETE_ALL_DATA</code> to confirm:</p>
            <input type="text" class="confirmation-input" id="allConfirmText" placeholder="Type confirmation text here">
            <div style="margin-top: 15px;">
                <button class="confirm-button" onclick="executeResetAll()">Delete Everything</button>
                <button class="cancel-button" onclick="hideConfirmations()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        function showResetDataConfirmation() {
            hideConfirmations();
            document.getElementById('resetDataConfirmation').classList.add('show');
            document.getElementById('dataConfirmText').focus();
        }
        
        function showResetAllConfirmation() {
            hideConfirmations();
            document.getElementById('resetAllConfirmation').classList.add('show');
            document.getElementById('allConfirmText').focus();
        }
        
        function hideConfirmations() {
            document.getElementById('resetDataConfirmation').classList.remove('show');
            document.getElementById('resetAllConfirmation').classList.remove('show');
            document.getElementById('dataConfirmText').value = '';
            document.getElementById('allConfirmText').value = '';
            hideAlert();
        }
        
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = 'alert ' + type + ' show';
        }
        
        function hideAlert() {
            document.getElementById('alert').classList.remove('show');
        }
        
        function executeResetData() {
            const confirmText = document.getElementById('dataConfirmText').value;
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Deleting...';
            
            fetch('/admin/reset/data-only', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'confirm=' + encodeURIComponent(confirmText)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message + '. Deleted: ' + 
                        data.deleted.prices + ' prices, ' +
                        data.deleted.demands + ' demands, ' +
                        data.deleted.profits + ' profits.', 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showAlert('Error: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showAlert('Network error: ' + error.message, 'error');
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'Delete Data';
                hideConfirmations();
            });
        }
        
        function executeResetAll() {
            const confirmText = document.getElementById('allConfirmText').value;
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Deleting...';
            
            fetch('/admin/reset/all', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'confirm=' + encodeURIComponent(confirmText)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert(data.message + '. Deleted: ' + 
                        data.deleted.companies + ' companies, ' +
                        data.deleted.prices + ' prices, ' +
                        data.deleted.demands + ' demands, ' +
                        data.deleted.profits + ' profits.', 'success');
                    setTimeout(() => location.reload(), 2000);
                } else {
                    showAlert('Error: ' + data.error, 'error');
                }
            })
            .catch(error => {
                showAlert('Network error: ' + error.message, 'error');
            })
            .finally(() => {
                button.disabled = false;
                button.textContent = 'Delete Everything';
                hideConfirmations();
            });
        }
        
        document.getElementById('dataConfirmText').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') executeResetData();
        });
        
        document.getElementById('allConfirmText').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') executeResetAll();
        });
    </script>
        </div>
    </div>
    
    <script src="/js/responsive-navbar.js"></script>
</body>
</html>